<html>
    
    <%- include('./partials/head.ejs') %>

    <body>

        <div class="details">
        <h1 class="mainTitle detailTitle"> <%= project.title %></h1>
        <div class="content  offset-5">

            <h2>Trigger:<span class="singleDetail"> <%= project.method %></span></h2>
            <h2>Model File Path: <span class="singleDetail"><%= project.filePath %></span></h2>
            <h2>GPS Lat: <span class="singleDetail"><%= project.lat %></span></h2>
            <h2>GPS Long:<span class="singleDetail"> <%= project.long %></span></h2>
            <h2>GPS Range: <span class="singleDetail"><%= project.gpsRange %></span></h2>
            <h2>Project ID:<span class="singleDetail"> <%= project._id %></span></h2>
            <button class="add_trigger">ADD</button>

            <form class="trigger_list" action="/projects/<%= project._id %>/add" method="POST" enctype="multipart/form-data"><button class="save_add">SAVE</button></form>

            <% if(project.trigger.length > 0){ %>

                <% for(let i = 0; project.trigger.length>i; i++) {%>
                    <br><br>
                    <h1>Trigger <%= i+1 %></h1>
                    <h2 class="trigger_name"> Name: <%= project.trigger[i].name %></h2>
                    <h2 class="trigger_id"> Trigger Id: <%= project.trigger[i]._id %></h2>
                    <h2 class="trigger_asset_path"> Asset Path: <%= project.trigger[i].asset_path %></h2>
                    <h2 class="trigger_position"> position: <%= project.trigger[i].asset_position.x %>, <%= project.trigger[i].asset_position.y %>, <%= project.trigger[i].asset_position.z %></h2>
                    <h2 class="trigger_rotation"> rotation: <%= project.trigger[i].asset_rotation.x %>, <%= project.trigger[i].asset_rotation.y %>, <%= project.trigger[i].asset_rotation.z %></h2>
                    <h2 class="trigger_size"> size: <%= project.trigger[i].asset_size.x %>, <%= project.trigger[i].asset_size.y %>, <%= project.trigger[i].asset_size.z %></h2>
                    <button><a  class="trigger_delete" data-project = "<%= project._id %>" data-trigger="<%= project.trigger[i]._id %>" > Delete </a></button>
                    <button><a  class="trigger_edit"> EDIT  </a></button>
                    <div class="edit_container">
                        <form action = '/projects/<%= project._id %>/<%= project.trigger[i]._id %>/edit' method="POST">
                            <br><br>
                            <label for="scale_x">Scale x</label>
                            <input type="number" name="scale_x" class="scale_x" value = "<%= project.trigger[i].asset_size.x %>" ><br>
                            <label for="scale_y">Scale y</label>
                            <input type="number" name="scale_y" class="scale_y" value = "<%= project.trigger[i].asset_size.y %>"><br>
                            <label for="scale_y">Scale z</label>
                            <input type="number" name="scale_z" class="scale_z" value = "<%= project.trigger[i].asset_size.z %>"><br><br>

                            <label for="position_x">Position x</label>
                            <input type="number" name="position_x" class="position_x" value = "<%= project.trigger[i].asset_position.x %>"><br>
                            <label for="position_y">Position y</label>
                            <input type="number" name="position_y" class="position_y" value = "<%= project.trigger[i].asset_position.y %>"><br>
                            <label for="position_y">Position z</label>
                            <input type="number" name="position_z" class="position_z" value = "<%= project.trigger[i].asset_position.z %>"><br><br>

                            <label for="rotation_x">Rotation x</label>
                            <input type="number" name="rotation_x" class="rotation_x" value = "<%= project.trigger[i].asset_rotation.x %>"><br>
                            <label for="rotation_y">Rotation y</label>
                            <input type="number" name="rotation_y" class="rotation_y" value = "<%= project.trigger[i].asset_rotation.y %>"><br>
                            <label for="rotation_y">Rotation z</label>
                            <input type="number" name="rotation_z" class="rotation_z" value = "<%= project.trigger[i].asset_rotation.z %>"><br><br>
                            <button class="edit_save">SAVE</button>
                        </form>
                    </div>
                    

                
                    <% } %>

            <% } %>

        </div>

        <div class="setButtons">
            <button class="offset-5"><a  class="view" data-doc="<%= project._id %>"  href="/projects/"> Back </a></button>
            <button><a  class="view" data-doc="<%= project._id %>"  href="/projects/<%= project._id %>/"> View </a></button>
            <button><a  class="delete" data-doc="<%= project._id %>" > Delete  </a></button>
        </div>

        </div>


        <script>
            const trashcan = document.querySelector(".delete") 

            trashcan.onclick = () => {
                
                const endpoint = `/projects/${trashcan.dataset.doc}`



                fetch(endpoint,{
                    method:"DELETE"
                })
                .then((response)=>{return response.json()})
                .then((data)=>window.location.href = data.redirect)
                .catch((err)=>console.log(err))

            }

            let triggerDelete = document.querySelectorAll(".trigger_delete")
            for(let i = 0; i < triggerDelete.length; i++){
                triggerDelete[i].onclick = function(){
                    const triggerEndpoint = `/projects/${triggerDelete[i].dataset.project}/${triggerDelete[i].dataset.trigger}/delete`
                    fetch(triggerEndpoint,{
                        method:"PUT"
                    })
                    .then((response)=>{return response.json()})
                    .then((data)=>window.location.href = data.redirect)
                    .catch((err)=>console.log(err))

                }
            }

            let editButton = document.querySelectorAll(".trigger_edit")
            for(let i = 0; i < editButton.length; i++){
                let editContainer = editButton[i].parentNode.nextSibling.nextSibling
                console.log(editButton[i])
                console.log(editButton[i].parentNode.nextSibling.nextSibling)
                editContainer.style.display = "none"
                let active = false
                editButton[i].onclick = function(){
                    if(!active){
                    editContainer.style.display = "block"
                    active = true
                    }else{
                        editContainer.style.display = "none"
                        active = false
                    }
                }
            }

            $(".add_trigger").on("click", function(e){
        e.preventDefault()
        let currentHTML = $('.trigger_list').html()

        $(".trigger_list").html(
            `
            <div class="trigger_container">
                <br><br>
            <label for="trigger_name">Trigger Name</label>
            <input type="text" name="trigger_name" class="trigger_name" value="Untitled"><br><br>

            <label for="modelFile">Upload Model</label><br>
            <input type="file" name="modelFile" class="modelFile">
            <br><br>

            <label for="scale_x">Scale x</label>
            <input type="number" name="scale_x" class="scale_x" value = 1><br>
            <label for="scale_y">Scale y</label>
            <input type="number" name="scale_y" class="scale_y" value = 1><br>
            <label for="scale_y">Scale z</label>
            <input type="number" name="scale_z" class="scale_z" value = 1><br><br>

            <label for="position_x">Position x</label>
            <input type="number" name="position_x" class="position_x" value = 0><br>
            <label for="position_y">Position y</label>
            <input type="number" name="position_y" class="position_y" value = 0><br>
            <label for="position_y">Position z</label>
            <input type="number" name="position_z" class="position_z" value = 0><br><br>

            <label for="rotation_x">Rotation x</label>
            <input type="number" name="rotation_x" class="rotation_x" value = 0><br>
            <label for="rotation_y">Rotation y</label>
            <input type="number" name="rotation_y" class="rotation_y" value = 0><br>
            <label for="rotation_y">Rotation z</label>
            <input type="number" name="rotation_z" class="rotation_z" value = 0><br><br>

            <h1 class="delete_trigger" style="cursor:pointer;">DELETE</h1>
            <br><br>
            </div>` + currentHTML


        )


        $(".delete_trigger").click(function(){
            let parentDiv = this.parentElement
            console.log(parentDiv)
            parentDiv.remove()
        })


    })

            $(".save_add").hide()
            $(".add_trigger").click(function(){
                $(".save_add").show()
            })

        </script>

    </body>

    <!--
        <section id="transformSection">
            <div class="scale transformBoxes">
                <div class="transformTitle">
                    <h3>Scale</h3>
                    <h3>&#9662;</h3>
                </div>
                <div id="scaleSliders" class="slideWrapper">
                    <div class="sliderSection">
                        <label for="xValue" class="label">X</label>
                        <input type="text" name="xValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="xRange">
                    </div>
                    <div class="sliderSection">
                        <label for="yValue" class="label">Y</label>
                        <input type="text" name="yValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="yRange">
                    </div>
                    <div class="sliderSection">
                        <label for="zValue" class="label">Z</label>
                        <input type="text" name="zValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="zRange">
                    </div>
                </div>
            </div>

            <div class="position transformBoxes">
                <div class="transformTitle">
                    <h3>Position</h3>
                    <h3>&#9662;</h3>
                </div>
                <div id="positionSliders" class="slideWrapper">
                    <div class="sliderSection">
                        <label for="xValue" class="label">X</label>
                        <input type="text" name="xValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="xRange">
                    </div>
                    <div class="sliderSection">
                        <label for="yValue" class="label">Y</label>
                        <input type="text" name="yValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="yRange">
                    </div>
                    <div class="sliderSection">
                        <label for="zValue" class="label">Z</label>
                        <input type="text" name="zValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="zRange">
                    </div>
                </div>
            </div>

            <div class="rotation transformBoxes">
                <div class="transformTitle">
                    <h3>Rotation</h3>
                    <h3>&#9662;</h3>
                </div>
                <div id="rotationSliders" class="slideWrapper">
                    <div class="sliderSection">
                        <label for="xValue" class="label">X</label>
                        <input type="text" name="xValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="xRange">
                    </div>
                    <div class="sliderSection">
                        <label for="yValue" class="label">Y</label>
                        <input type="text" name="yValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="xRange">
                    </div>
                    <div class="sliderSection">
                        <label for="zValue" class="label">Z</label>
                        <input type="text" name="zValue" value="0" class="input">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="xRange">
                    </div>
                </div>
            </div>
        </section>
    -->


</html>

